Spring Security Filters: Cháº·n vÃ  kiá»ƒm tra authentication.
Authentication: TrÃ­ch xuáº¥t thÃ´ng tin Ä‘Äƒng nháº­p tá»« request.
AuthenticationManager: Quáº£n lÃ½ quy trÃ¬nh xÃ¡c thá»±c.
AuthenticationProvider: XÃ¡c thá»±c user chi tiáº¿t.
UserDetailsService: Láº¥y thÃ´ng tin user tá»« DB.
PasswordEncoder: MÃ£ hÃ³a máº­t kháº©u.
SecurityContext: LÆ°u tráº¡ng thÃ¡i Ä‘Äƒng nháº­p cá»§a user

SecurityFilterChain há»at Ä‘á»™ng vá»›i tham sá»‘ lÃ  HttpSecurity http
==> Cáº¥u hÃ¬nh nÃ³ báº±ng cÃ¡ch http.authorizeHttpRequests(cháº¥p nháº­n ká»ƒu tráº£ vá» lÃ  AuthorizeHttpRequestsConfigurer)
==> Vá»›i má»™t sá»‘ phÆ°Æ¡ng thá»©c sá»­ dá»¥ng lambda expression nhÆ° requestMatchers, permillAll, anyRequest,
                                                                          authenticated, formLogin(WithDefaults),
                                                                          hasRole

Táº¡o ra user trong ram thÃ´ng qua InMemoryUserDetailsManager
    UserDetailsService (loadUserByUserName) -> UserDetailsManager (CRUD) -> InMemoryUserDetailsManager (RAM)
    UserDetailsService (loadUserByUserName) -> UserDetailsManager (CRUD) -> JdbcUserDetailsManager (DB)

    ==> Táº¡o bean UserDetailsService vá»›i RAM sáº½ táº¡o ra 2 tÃ i khoáº£n


Trong viá»‡c táº¡o UserDetailsService vá»›i method máº·c Ä‘á»‹nh lÃ  roles("ADMIN") spring security sáº½ tá»± thÃªm ROLE_ vÃ o phÃ­a trÆ°á»›c Ä‘á»ƒ hiá»ƒu
ngoÃ i ra náº¿u sá»­ dá»¥ng method authorities("ROLE_ADMIN") pháº£i thÃªm thá»§ cong ROLE_ vÃ o phÃ­a trÆ°á»›c

á» pháº§n cáº¥u hÃ¬nh filterChains hasRole("ADMIN") spring security sáº½ tá»± thÃªm ROLE_ vÃ o phÃ­a trÆ°á»›c Ä‘á»ƒ hiá»ƒu ta khÃ´ng cáº§n thÃªm vÃ o phÃ­a trÆ°á»›c cá»§a nÃ³
Náº¿u muá»‘n tá»± thÃªm thÃ¬ sá»­ dá»¥ng method authorities("ROLE_ADMIN")

==> Máº·c Ä‘á»‹nh hasRole chá»‰ hiá»ƒu 2 dá»¯ liá»‡u lÃ  ROLE_ADMIN vÃ  ROLE_USER cÃ¡c quyá»n khÃ¡c nhÆ° READ, WRITE thÃ¬ sáº½ pháº£i sá»­ dá»¥ng
method hasAnyAuthority("WRITE", "READ", "DELETE") hoáº·c hasAuthority(kiá»ƒm tra 1 quyá»n cá»¥ thá»ƒ) vÃ  á»Ÿ user pháº£i lÃ  authorities(tá»± cÃ i Ä‘áº·t theo Ã½ muá»‘n)

==> Náº¿u Ä‘Ã£ hasRole() thÃ¬ tiáº¿p tá»¥c sáº½ khÃ´ng thá»ƒ sá»­ dá»¥ng hasAnyAuthority nÃªn náº¿u cÃ³ nhá»u quyá»n thÃ¬ pháº£i set authorities vÃ  hasAnyAuthority

==> Note:
    Trong viá»‡c cáº¥u hÃ¬nh filterChains thÃ¬ requestMatchers("/api/*") sáº½ ghi Ä‘Ã¨ toÃ n bo cach cÃ i Ä‘áº·t lÃºc trÆ°á»›c vÃ  náº¿u set quyá»n thÃ¬ chá»‰ cÃ³ quyá»n Ä‘Ã³ má»›i duoc truy cáº­p vÃ o
    Náº¿u sá»­ dá»¥ng hasAnyAuthority("READ", "WRITE") vá»›i viá»‡c nÃ y thÃ¬ chÃºng ta khÃ´ng thá»ƒ hiá»ƒu lÃ  Ä‘ truy cáº­p má»™t link cá»¥ thá»ƒ cáº§n cÃ³ 2 quyen READ WRITE
    NÃ³ tá»± hiá»ƒu lÃ  cÃ³ má»™t trong cÃ¡c quyá»n Ä‘Ã³ lÃ  Ä‘á»±oc

    Sá»­ dá»¥ng access(allOf(hasAuthority("READ") or hasAnyAuthority("WRITE"))) cho phÃ©p truy cáº­p cáº£ 2

    á» phÃ­a cÃ i Ä‘áº·t tÃ i khoáº£n náº¿u chÃºng ta sá»­ dá»¥ng roles("USER").authorities("READ", "WRITE") thÃ¬ sáº½ bá»‹ authorities ghi Ä‘Ã¨ vÃ  máº¥t quyá»n USER
    => Sá»­ dá»¥ng chá»‰ má»™t authorities("READ", "WRITE", "ROLE_USER") lÃ  Ä‘áº§y Ä‘á»§ cÃ¡c quyá»n

==> Äá»I Vá»šI Sá»¬ Dá»¤NG JWT xÃ¢y dá»±ng cÆ¡ cháº¿ xÃ¡c thá»±c thÃ¬ máº·c Ä‘á»‹nh sáº½ phÃ¡ bá» cÆ¡ cháº¿ xÃ¢y dung máº·c dinh cá»§a spring security
==> Máº·c Ä‘á»‹nh spring security cÃ³ cÃ¡c cÆ¡ cháº¿ xÃ¡c tá»± áº·c Ä‘á»‹nh thng qua formLogin, basicAuth sáº½ hiá»‡n UI Ä‘Äƒng nháº­p va cÃ³ thá»ƒ
xÃ¡c thá»±c báº±ng BasicAuth trong postman thá»±c táº¿ thÃ¬ khÃ´ng cáº§n váº­y náº¿u ta xÃ¢y dá»±ng tá»± tay thÃ¬ nÃ³ bÃ¡c bá» máº·cdidinh Ä‘i vÃ  ta
sáº½ xem nhÆ° khi nÃ o ngÆ°á»i dÃ¹ng nháº¥n vÃ o nÃºt login thÃ¬ nÃ³ sáº½ lÃ  request Ä‘áº¿n application cá»§a chÃºng ta:
    *JWT TOKEN: cho phÃ©p xÃ¡c thá»±c ngÆ°á»i dÃ¹ng khÃ´ng tráº¡ng thÃ¡i khÃ´ng cáº§n session - sá»­ dá»¥ng Secret Key Ä‘á»ƒ ky cÃ¡c token xÃ¡c thá»±c
    + Äá»‘i vá»›i cÃ¡i nÃ y thÃ¬ má»™t token cÃ³ 3 pháº§n:
        - Header: cÃ¡i dÃ¹ng Ä‘á»ƒ setup thuáº­t toÃ¡n kÃ½ sá»‘ khi gá»£p thÃ nh má»™t JWT hoáº·c JWSObject
        - Payload xÃ¢y dá»±ng tá»« ClaimSet vá»›i cÃ¡c yáº¿u toosL Subject, tokenId, IssuedAt, ExpiredAt, Issuer, Audience, Signature
        - Signature: táº¡o thÃ nh cÃ³ thá»ƒ tá»« SignedJWT hoáº·c JWSObject ==> new SignedJWT(header, payload) hoáº·c new JWSObject(header, payload)

    + Trong JWT token thÃ¬ chia lÃ m 3 loáº¡i token nhÆ°:
    - Access Token - dÃ¹ng Ä‘á»ƒ truy cap tÃ i nguyÃªn xÃ¡c thá»±c ngÆ°á»i dÃ¹ng
    - Refresh Token -  dÃ¹ng Ä‘á»ƒ táº¡o láº¡i access Token Ä‘á»ƒ ngÆ°á»i cÃ¹ng tiáº¿p tá»¥c truy cáº­p
    - Invalid Token - khi cáº£ Access Token vÃ  Refresh Token Ä‘iá»u háº¿t háº¡n thÃ¬ sáº½ Ä‘Æ°a nÃ³ vÃ o Invalid Token

    Access Token ğŸŸï¸ â†’ DÃ¹ng Ä‘á»ƒ truy cáº­p API (cÃ³ thá»ƒ bá»‹ giá»›i háº¡n thá»i gian).
    Refresh Token ğŸ”„ â†’ KhÃ´ng dÃ¹ng Ä‘á»ƒ truy cáº­p API, chá»‰ dÃ¹ng Ä‘á»ƒ xin Access Token má»›i khi cÃ¡i cÅ© háº¿t háº¡n.

        ğŸ“Œ CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Refresh Token
    1ï¸âƒ£ NgÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p â†’ Há»‡ thá»‘ng cáº¥p cáº£ Access Token + Refresh Token.
    2ï¸âƒ£ Access Token háº¿t háº¡n â†’ Gá»­i Refresh Token lÃªn Ä‘á»ƒ xin Access Token má»›i.
    3ï¸âƒ£ Server kiá»ƒm tra Refresh Token há»£p lá»‡ â†’ Cáº¥p Access Token má»›i.
    4ï¸âƒ£ (Tuá»³ há»‡ thá»‘ng) Server cÃ³ thá»ƒ cáº¥p luÃ´n Refresh Token má»›i Ä‘á»ƒ tÄƒng báº£o máº­t.
    5ï¸âƒ£ Náº¿u Refresh Token háº¿t háº¡n hoáº·c bá»‹ thu há»“i â†’ NgÆ°á»i dÃ¹ng pháº£i Ä‘Äƒng nháº­p láº¡i.


    Má»—i láº§n cáº¥p láº¡i Access Token thÃ¬ cÃ³ cáº§n lÃ m má»›i Refresh Token khÃ´ng?

    âœ… CÃ¢u tráº£ lá»i: Tuá»³ vÃ o cÃ¡ch triá»ƒn khai! CÃ³ 2 cÃ¡ch phá»• biáº¿n:

    ğŸ”¹ CÃ¡ch 1: KhÃ´ng lÃ m má»›i Refresh Token (Stateless - CÃ¡ch Ä‘Æ¡n giáº£n)
    Khi Access Token háº¿t háº¡n, client gá»­i Refresh Token lÃªn Ä‘á»ƒ láº¥y Access Token má»›i.
    Refresh Token váº«n giá»¯ nguyÃªn vÃ  tiáº¿p tá»¥c sá»­ dá»¥ng cho láº§n sau.
    Chá»‰ khi Refresh Token háº¿t háº¡n, ngÆ°á»i dÃ¹ng báº¯t buá»™c pháº£i Ä‘Äƒng nháº­p láº¡i.
    ğŸ’¡ Æ¯u Ä‘iá»ƒm:
    âœ”ï¸ Dá»… triá»ƒn khai, khÃ´ng cáº§n lÆ°u trá»¯ Refresh Token trÃªn server.
    âœ”ï¸ PhÃ¹ há»£p vá»›i há»‡ thá»‘ng Stateless (REST API).
    âŒ NhÆ°á»£c Ä‘iá»ƒm:
    Náº¿u hacker Ä‘Ã¡nh cáº¯p Refresh Token, háº¯n cÃ³ thá»ƒ láº¥y Access Token má»›i mÃ£i mÃ£i cho Ä‘áº¿n khi Refresh Token háº¿t háº¡n.

    ğŸ”¹ CÃ¡ch 2: LÃ m má»›i Refresh Token má»—i láº§n cáº¥p láº¡i Access Token (CÃ¡ch báº£o máº­t hÆ¡n)
    Khi Access Token háº¿t háº¡n, client gá»­i Refresh Token lÃªn Ä‘á»ƒ láº¥y Access Token má»›i.
    Server sáº½ cáº¥p cáº£ Access Token má»›i & Refresh Token má»›i.
    Refresh Token cÅ© bá»‹ vÃ´ hiá»‡u hÃ³a Ä‘á»ƒ trÃ¡nh bá»‹ láº¡m dá»¥ng.
    ğŸ’¡ Æ¯u Ä‘iá»ƒm:
    âœ”ï¸ Báº£o máº­t cao hÆ¡n, vÃ¬ náº¿u hacker láº¥y Ä‘Æ°á»£c Refresh Token, háº¯n chá»‰ cÃ³ thá»ƒ dÃ¹ng 1 láº§n.
    âœ”ï¸ Giáº£m nguy cÆ¡ token reuse (káº» táº¥n cÃ´ng dÃ¹ng láº¡i token cÅ©).

    âŒ NhÆ°á»£c Ä‘iá»ƒm:
    Phá»©c táº¡p hÆ¡n, vÃ¬ server pháº£i lÆ°u danh sÃ¡ch Refresh Token há»£p lá»‡.

    ğŸ”¹ CÃ¡ch nÃ o tá»‘t hÆ¡n?
    Há»‡ thá»‘ng khÃ´ng lÆ°u tráº¡ng thÃ¡i (Stateless API) â†’ CÃ¡ch 1 (khÃ´ng lÃ m má»›i Refresh Token).
    Há»‡ thá»‘ng cÃ³ lÆ°u phiÃªn Ä‘Äƒng nháº­p (Stateful API) â†’ CÃ¡ch 2 (lÃ m má»›i Refresh Token).

    ğŸ‘‰ CÃ¡ch tá»‘t nháº¥t:
    Náº¿u dÃ¹ng CÃ¡ch 1, hÃ£y Ã¡p dá»¥ng cÆ¡ cháº¿ phÃ¡t hiá»‡n Refresh Token bá»‹ Ä‘Ã¡nh cáº¯p, vÃ­ dá»¥:
    LÆ°u Refresh Token hash trÃªn server Ä‘á»ƒ kiá»ƒm tra.
    Chá»‰ cháº¥p nháº­n Refresh Token tá»« IP & thiáº¿t bá»‹ giá»‘ng lÃºc táº¡o.
    Náº¿u dÃ¹ng CÃ¡ch 2, server cáº§n lÆ°u danh sÃ¡ch Refresh Token Ä‘Ã£ cáº¥p.

    ğŸ’¡ TÃ³m láº¡i:
    CÃ¡ch CÃ³ lÃ m má»›i Refresh Token?	Khi nÃ o dÃ¹ng?
    CÃ¡ch 1 âŒ KhÃ´ng lÃ m má»›i	Há»‡ thá»‘ng Stateless, Ä‘Æ¡n giáº£n, Ã­t lÆ°u trá»¯
    CÃ¡ch 2 âœ… LÃ m má»›i Báº£o máº­t cao hÆ¡n, há»‡ thá»‘ng cÃ³ lÆ°u phiÃªn Ä‘Äƒng nháº­p
    Báº¡n Ä‘ang triá»ƒn khai theo hÆ°á»›ng nÃ o? ğŸš€




































